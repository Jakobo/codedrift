# Thunked Category ID: DIC_kwDOFC_g4s4CAYqP

# Fragment of everything we need to render a post
fragment PostDetails on Discussion {
  id
  title
  lastEditedAt
  url
  labels(first: 100) {
    nodes {
      id
      name
      description
    }
  }
  author {
    avatarUrl(size: 10)
    ... on User {
      id
      name
    }
  }
  body
}

# Get the recently created posts. Uses orderBy CREATED_AT
query SelectRecentlyCreatedPosts($first: Int = 3, $after: String) {
  repository(owner: "jakobo", name: "codedrift") {
    discussions(
      categoryId: "DIC_kwDOFC_g4s4CAYqP"
      first: $first
      after: $after
      orderBy: { field: CREATED_AT, direction: DESC }
    ) {
      nodes {
        ...PostDetails
      }
      totalCount
      pageInfo {
        endCursor
        hasNextPage
        hasPreviousPage
        startCursor
      }
    }
  }
}

# Get a specific post with a query
# Required because trying to use slug/title is a search operator inside body,
# meaning there's no good way to find a slug.
# A "hasNextPage" tells us if we screwed up.
# Get By Slug:
#   "slug: phpbb-permissioning" in:body category:"Thunked" author:@me repo:jakobo/codedrift"
# Get By Category:
#   label:"üìö ${category}" category:"Thunked" author:@me repo:jakobo/codedrift"
# Get By Tag:
#   label:"üè∑ ${tag}" category:"Thunked" author:@me repo:jakobo/codedrift"
query SelectPostsWithSearch($search: String!, $first: Int = 1, $after: String) {
  search(first: $first, after: $after, type: DISCUSSION, query: $search) {
    nodes {
      ... on Discussion {
        ...PostDetails
      }
    }
    discussionCount
    pageInfo {
      endCursor
      hasNextPage
      hasPreviousPage
      startCursor
    }
  }
}

# Alternative query when you can do repository.labels.nodes.discussions.nodes
# query SelectPostsInLabel {
#   repository(name: "codedrift", owner: "jakobo") {
#     label(name: "üìö Code") {
#       id
#       name
#     }
#   }
# }
